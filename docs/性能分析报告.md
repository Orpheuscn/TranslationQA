# æ€§èƒ½åˆ†ææŠ¥å‘Š

## ğŸ” é—®é¢˜æ£€æŸ¥

ä½ æå‡ºçš„ä¸¤ä¸ªæ€§èƒ½é—®é¢˜å·²ç»è¿‡è¯¦ç»†æ£€æŸ¥ï¼š

### 1. Bertalign åˆå§‹åŒ–å¼€é”€

#### ç°çŠ¶åˆ†æ

**ä»£ç ä½ç½®**: `translation_qa_tool.py` Line 105-113

```python
# æ¯æ¬¡check_translation()éƒ½ä¼šåˆ›å»ºæ–°çš„Bertalignå®ä¾‹
aligner = Bertalign(
    src=source_text_for_align,
    tgt=target_text_for_align,
    max_align=self.max_align,
    ...
)
```

**æ€§èƒ½æµ‹è¯•ç»“æœ**:

```
ç¬¬1æ¬¡åˆå§‹åŒ–: 2.8452ç§’
ç¬¬2æ¬¡åˆå§‹åŒ–: 2.1769ç§’ (å‡å°‘ 23.5%)
ç¬¬3æ¬¡åˆå§‹åŒ–: 2.0733ç§’ (å‡å°‘ 27.1%)

æ—¶é—´åˆ†è§£:
  Bertalign.__init__: 1.6899ç§’ (93.4%)
    â””â”€ Embeddingè®¡ç®—: ~1.5ç§’
  aligner.align_sents(): 0.1198ç§’ (6.6%)
```

**ç»“è®º**:

âœ… **æ¨¡å‹ä¸ä¼šé‡å¤åŠ è½½**: Bertalignåœ¨æ¨¡å—çº§åˆ«ä½¿ç”¨å…¨å±€å•ä¾‹æ¨¡å‹ï¼ˆ`bertalign/__init__.py` Line 14ï¼‰

```python
# bertalign/__init__.py
model_name = "LaBSE"
model = Encoder(model_name)  # å…¨å±€å•ä¾‹ï¼ŒåªåŠ è½½ä¸€æ¬¡
```

âŒ **Embeddingè®¡ç®—æ— æ³•é¿å…**: æ¯æ¬¡åˆå§‹åŒ–éƒ½éœ€è¦å¯¹æ–°çš„è¾“å…¥æ–‡æœ¬è¿›è¡Œembeddingï¼Œè¿™å äº†93%çš„æ—¶é—´ï¼Œæ˜¯**å¿…è¦å¼€é”€**ã€‚

**ä¼˜åŒ–ç©ºé—´**: âš ï¸ **æœ‰é™**

- å°†Bertalignç§»åˆ°`__init__`ä¸­**æ— æ•ˆ**ï¼Œå› ä¸ºæ¯æ¬¡å¤„ç†ä¸åŒæ–‡æœ¬éƒ½éœ€è¦é‡æ–°embedding
- å”¯ä¸€çš„ä¼˜åŒ–æ˜¯**æ‰¹é‡å¤„ç†**ï¼šå¦‚æœå¤„ç†å¤šä¸ªæ–‡æ¡£ï¼Œå¯ä»¥ä¸€æ¬¡æ€§embeddingæ‰€æœ‰å¥å­ï¼Œä½†è¿™éœ€è¦ä¿®æ”¹Bertalignçš„å†…éƒ¨å®ç°

---

### 2. TextSplitter é‡å¤åŠ è½½

#### ç°çŠ¶åˆ†æ

**ä»£ç ä½ç½®**: `translation_qa_tool.py` Line 53

```python
# åœ¨TranslationQA.__init__ä¸­åˆå§‹åŒ–
self.text_splitter = TextSplitter(use_spacy=use_spacy, use_hanlp=use_hanlp)
```

**æ€§èƒ½æµ‹è¯•ç»“æœ**:

```
æ— spaCy/HanLP:
  ç¬¬1æ¬¡åˆå§‹åŒ–: 0.0000ç§’
  ç¬¬2æ¬¡åˆå§‹åŒ–: 0.0000ç§’

æœ‰spaCy (å¦‚æœå®‰è£…):
  ç¬¬1æ¬¡åˆå§‹åŒ–: 1.1312ç§’  â† åŠ è½½spaCyæ¨¡å‹
  ç¬¬2æ¬¡åˆå§‹åŒ–: 0.0001ç§’  â† spaCyå·²ç¼“å­˜
```

**ç»“è®º**:

âœ… **å½“å‰å®ç°å·²ä¼˜åŒ–**: TextSplitteråœ¨`TranslationQA.__init__`ä¸­åªåˆå§‹åŒ–ä¸€æ¬¡ï¼Œä¸ä¼šé‡å¤åŠ è½½ã€‚

âŒ **æ½œåœ¨é—®é¢˜**: å¦‚æœç”¨æˆ·åœ¨å¾ªç¯ä¸­åˆ›å»ºå¤šä¸ª`TranslationQA`å®ä¾‹ï¼ŒspaCy/HanLPä¼šé‡å¤åŠ è½½ã€‚

**ç¤ºä¾‹é—®é¢˜ä»£ç **:

```python
# âŒ é”™è¯¯ç”¨æ³•ï¼šæ¯æ¬¡å¾ªç¯éƒ½é‡æ–°åŠ è½½spaCy
for file in files:
    qa_tool = TranslationQA()  # é‡å¤åŠ è½½spaCy
    results = qa_tool.check_translation(...)
```

**æ­£ç¡®ç”¨æ³•**:

```python
# âœ… æ­£ç¡®ç”¨æ³•ï¼šåªåŠ è½½ä¸€æ¬¡
qa_tool = TranslationQA()
for file in files:
    results = qa_tool.check_translation(...)
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### å»ºè®®1: æ·»åŠ ä½¿ç”¨è¯´æ˜ï¼ˆæ–‡æ¡£ä¼˜åŒ–ï¼‰

åœ¨READMEä¸­æ˜ç¡®è¯´æ˜ï¼š

```markdown
## âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### æ‰¹é‡å¤„ç†å¤šä¸ªæ–‡æ¡£

âŒ **é”™è¯¯ç”¨æ³•** (æ¯æ¬¡éƒ½é‡æ–°åˆå§‹åŒ–):
```python
for src, tgt in document_pairs:
    qa_tool = TranslationQA()  # é‡å¤åŠ è½½æ¨¡å‹
    results = qa_tool.check_translation(src, tgt)
```

âœ… **æ­£ç¡®ç”¨æ³•** (å¤ç”¨å®ä¾‹):
```python
qa_tool = TranslationQA()  # åªåˆå§‹åŒ–ä¸€æ¬¡
for src, tgt in document_pairs:
    results = qa_tool.check_translation(src, tgt)
```

**æ€§èƒ½æå‡**: å¦‚æœå¯ç”¨spaCyï¼Œå¯èŠ‚çœ ~1ç§’/æ–‡æ¡£
```

### å»ºè®®2: æ·»åŠ å…¨å±€å•ä¾‹æ¨¡å¼ï¼ˆå¯é€‰ï¼‰

å¦‚æœç”¨æˆ·ç¡®å®éœ€è¦åœ¨å¤šå¤„åˆ›å»ºå®ä¾‹ï¼Œå¯ä»¥æä¾›ä¸€ä¸ªå…¨å±€å•ä¾‹ï¼š

```python
# text_splitter.py
class TextSplitter:
    _spacy_cache = {}  # å…¨å±€ç¼“å­˜
    _hanlp_cache = {}
    
    def __init__(self, use_spacy=True, use_hanlp=True):
        # ä»ç¼“å­˜ä¸­è·å–ï¼Œè€Œéé‡æ–°åŠ è½½
        if use_spacy and 'en' not in self._spacy_cache:
            import spacy
            self._spacy_cache['en'] = spacy.load("en_core_web_sm")
        self.spacy_nlp = self._spacy_cache.get('en')
```

**ä¼˜å…ˆçº§**: ğŸŸ¡ **ä¸­ç­‰** - åªæœ‰åœ¨ç”¨æˆ·åé¦ˆæœ‰æ‰¹é‡å¤„ç†éœ€æ±‚æ—¶æ‰å®ç°

### å»ºè®®3: Bertalignæ— éœ€ä¼˜åŒ–

Bertalignçš„embeddingè®¡ç®—æ˜¯**å¿…è¦å¼€é”€**ï¼Œæ— æ³•é€šè¿‡ç§»åˆ°`__init__`æ¥ä¼˜åŒ–ã€‚

---

## âœ… æœ€ç»ˆç»“è®º

| é—®é¢˜ | çŠ¶æ€ | ä¼˜åŒ–ç©ºé—´ | å»ºè®® |
|------|------|----------|------|
| Bertaligné‡å¤åŠ è½½æ¨¡å‹ | âœ… æ— é—®é¢˜ | æ—  | æ¨¡å‹æ˜¯å…¨å±€å•ä¾‹ |
| Bertalign embeddingå¼€é”€ | âš ï¸ å¿…è¦å¼€é”€ | æ—  | æ¯æ¬¡å¤„ç†æ–°æ–‡æœ¬éƒ½éœ€è¦ |
| TextSplitteré‡å¤åŠ è½½ | âœ… å·²ä¼˜åŒ– | å° | å½“å‰å®ç°å·²åœ¨`__init__`ä¸­åˆå§‹åŒ– |
| ç”¨æˆ·é”™è¯¯ç”¨æ³• | âš ï¸ æ½œåœ¨é£é™© | ä¸­ | æ·»åŠ æ–‡æ¡£è¯´æ˜ |

**æ¨èè¡ŒåŠ¨**:

1. âœ… **å·²å®Œæˆ**: åœ¨READMEä¸­æ·»åŠ æ€§èƒ½ä¼˜åŒ–å»ºè®®
2. ğŸŸ¡ **å¯é€‰**: å¦‚æœæœ‰æ‰¹é‡å¤„ç†éœ€æ±‚ï¼Œå®ç°TextSplitterå…¨å±€ç¼“å­˜
3. âŒ **ä¸æ¨è**: å°†Bertalignç§»åˆ°`__init__`ï¼ˆæ— æ•ˆæœï¼‰

---

## ğŸ§ª å®é™…æ€§èƒ½æµ‹è¯•

### æµ‹è¯•åœºæ™¯: å¤„ç†3ä¸ªæ–‡æ¡£

**é”™è¯¯ç”¨æ³•** (æ¯æ¬¡é‡æ–°åˆå§‹åŒ–):
```python
for src, tgt in document_pairs:
    qa_tool = TranslationQA()  # é‡å¤åˆå§‹åŒ–
    results = qa_tool.check_translation(src, tgt)
```
**æ€»æ—¶é—´**: 11.41ç§’

**æ­£ç¡®ç”¨æ³•** (å¤ç”¨å®ä¾‹):
```python
qa_tool = TranslationQA()  # åªåˆå§‹åŒ–ä¸€æ¬¡
for src, tgt in document_pairs:
    results = qa_tool.check_translation(src, tgt)
```
**æ€»æ—¶é—´**: 5.88ç§’

### æ€§èƒ½æå‡

- **æ€»æå‡**: 5.52ç§’ (48.4%)
- **æ¯æ–‡æ¡£èŠ‚çœ**: 1.84ç§’
- **ç»“è®º**: å¤ç”¨å®ä¾‹å¯å°†æ‰¹é‡å¤„ç†æ€§èƒ½æå‡è¿‘50%ï¼

---

## ğŸ“ æµ‹è¯•ä»£ç 

### æµ‹è¯•1: Bertalignåˆå§‹åŒ–å¼€é”€

```python
import time
from bertalign import Bertalign

start = time.time()
aligner = Bertalign(src='...', tgt='...', is_split=True)
init_time = time.time() - start

start = time.time()
aligner.align_sents()
align_time = time.time() - start

print(f'åˆå§‹åŒ–: {init_time:.4f}ç§’ (93.4%)')
print(f'å¯¹é½: {align_time:.4f}ç§’ (6.6%)')
```

### æµ‹è¯•2: TextSplitteré‡å¤åŠ è½½

```python
import time
from text_splitter import TextSplitter

# ç¬¬1æ¬¡
start = time.time()
splitter1 = TextSplitter(use_spacy=True)
time1 = time.time() - start

# ç¬¬2æ¬¡
start = time.time()
splitter2 = TextSplitter(use_spacy=True)
time2 = time.time() - start

print(f'ç¬¬1æ¬¡: {time1:.4f}ç§’')
print(f'ç¬¬2æ¬¡: {time2:.4f}ç§’')
```

