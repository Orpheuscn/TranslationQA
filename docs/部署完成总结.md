# 翻译质量检查工具 - Web版部署完成总结

## ✅ 完成的工作

### 1. 清理测试文件

已删除：
- `test.py` - 原测试脚本
- `test_force_split.py` - 强制拆散测试脚本

### 2. 整理依赖

更新 `requirements.txt`，精简为核心依赖：
```
numpy>=1.24.0
onnx>=1.14.0
onnxruntime>=1.15.0
bertalign
transformers>=4.30.0
flask>=3.0.0
flask-cors>=4.0.0
```

### 3. 创建Web服务器

**app.py** - Flask服务器
- ✅ 全局复用QA工具实例（性能优化）
- ✅ RESTful API接口
- ✅ CORS支持
- ✅ 详细错误处理
- ✅ 健康检查接口

**API端点**:
- `GET /` - 主页
- `POST /api/check` - 翻译质量检查
- `GET /api/health` - 健康检查

### 4. 创建网页界面

**templates/index.html** - 主页面
- ✅ 原文/译文输入框
- ✅ 参数设置（相似度阈值、强制拆散阈值）
- ✅ 检测按钮（带加载动画）
- ✅ 结果展示（统计信息、CSV表格）
- ✅ 下载CSV按钮
- ✅ 复制表格按钮

**static/style.css** - 样式文件
- ✅ 渐变背景设计
- ✅ 响应式布局
- ✅ 颜色编码（绿色=OK，黄色=警告，红色=错误）
- ✅ 平滑动画效果

**static/script.js** - 前端脚本
- ✅ API请求处理
- ✅ CSV解析和表格渲染
- ✅ 下载和复制功能
- ✅ 错误处理

### 5. 配置模型路径

**labse_onnx_encoder.py** - 更新
- ✅ 自动使用脚本所在目录下的 `labse_onnx/` 相对路径
- ✅ 支持自定义路径参数

### 6. 创建启动脚本

**start_server.sh** - 一键启动
- ✅ 检查虚拟环境
- ✅ 激活虚拟环境
- ✅ 安装依赖
- ✅ 启动服务器

**test_api.sh** - API测试脚本
- ✅ 测试POST /api/check接口

### 7. 创建文档

- ✅ **WEB_README.md** - Web版使用说明
- ✅ **项目结构说明.md** - 项目结构详解
- ✅ **部署完成总结.md** - 本文件

---

## 🚀 快速开始

### 方法1: 使用启动脚本（推荐）

```bash
./start_server.sh
```

### 方法2: 手动启动

```bash
# 激活虚拟环境
source venv/bin/activate

# 安装依赖（首次运行）
pip install -r requirements.txt

# 启动服务器
python app.py
```

### 访问网页

打开浏览器访问: **http://localhost:5001**

---

## 📊 功能特性

### 核心功能

✅ **句子级对齐**: 使用Bertalign进行N:M语义对齐
✅ **异常检测**: 检测缺失、增添、相似度低三种异常
✅ **强制拆散**: 将低相似度对齐组拆散为缺失+增添
✅ **最小相似度策略**: 避免向量平均掩盖不相关句子

### Web功能

✅ **实时检测**: 输入文本后即时检测
✅ **参数调整**: 可调整相似度阈值和强制拆散阈值
✅ **结果展示**: 统计信息、CSV表格、颜色编码
✅ **导出功能**: 下载CSV、复制表格

### 性能优化

✅ **模型复用**: 全局单例，避免重复加载
✅ **ONNX加速**: 使用ONNX Runtime，避免PyTorch崩溃
✅ **批量编码**: 一次编码多个句子

---

## 📁 项目结构

```
语义对齐/
├── app.py                      # Flask服务器
├── translation_qa_tool.py      # 核心工具
├── labse_onnx_encoder.py       # ONNX编码器
├── text_splitter.py            # 分句模块
├── requirements.txt            # 依赖列表
├── start_server.sh             # 启动脚本
├── test_api.sh                 # API测试脚本
├── templates/
│   └── index.html              # 网页界面
├── static/
│   ├── style.css               # 样式文件
│   └── script.js               # 前端脚本
├── labse_onnx/                 # LaBSE模型
│   ├── model.onnx
│   ├── config.json
│   └── ...
└── docs/                       # 文档
    ├── WEB_README.md
    ├── 项目结构说明.md
    └── ...
```

---

## 🎯 使用示例

### 1. 打开网页

访问 http://localhost:5001

### 2. 输入文本

**原文**:
```
The quantum processor operates at near-zero temperatures.
Machine learning algorithms require large datasets.
Blockchain technology ensures data integrity.
```

**译文**:
```
量子处理器在接近零度的温度下运行。
机器学习算法需要大量数据集。
今天天气很好，适合出去散步。
区块链技术确保数据完整性。
```

### 3. 点击"开始检测"

等待几秒钟（首次运行会加载模型）

### 4. 查看结果

**统计信息**:
- 源文本句子数: 3
- 目标文本句子数: 4
- 对齐组数: 3

**发现的问题**:
- 缺失: 1处
- 增添: 2处
- 相似度低: 0处

**CSV表格**:
显示每个句子的对齐情况，颜色编码标识异常

### 5. 导出结果

- 点击"💾 下载CSV"下载报告
- 点击"📋 复制表格"复制到剪贴板

---

## 🔧 参数说明

### 相似度阈值 (Similarity Threshold)

- **默认值**: 0.7
- **范围**: 0.0 - 1.0
- **说明**: 低于此值视为"相似度低"
- **建议**: 0.6 - 0.8

### 强制拆散阈值 (Force Split Threshold)

- **默认值**: 0.5
- **范围**: 0.0 - 1.0
- **说明**: 低于此值的对齐组将被拆散为缺失+增添
- **建议**: 0.4 - 0.6

---

## 📝 API文档

### POST /api/check

**请求体**:
```json
{
    "source_text": "原文",
    "target_text": "译文",
    "similarity_threshold": 0.7,
    "force_split_threshold": 0.5
}
```

**响应**:
```json
{
    "success": true,
    "data": {
        "csv": "CSV格式的报告",
        "summary": {...},
        "issues": {...},
        "force_split_count": 2
    }
}
```

---

## 🎉 总结

✅ **Web服务器已部署完成**
✅ **网页界面已创建完成**
✅ **模型路径已配置为相对路径**
✅ **所有依赖已整理完成**
✅ **文档已完善**

现在可以通过网页界面进行翻译质量检查了！🎊

