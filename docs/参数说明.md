# 参数说明文档

## 目录
- [质量检测参数](#质量检测参数)
- [Bertalign 对齐参数](#bertalign-对齐参数)
- [高级功能](#高级功能)
- [推荐配置](#推荐配置)

---

## 质量检测参数

### 1. 相似度阈值 (Similarity Threshold)

**参数名**: `similarity_threshold`  
**默认值**: `0.7`  
**取值范围**: `0.0 - 1.0`  
**步长**: `0.05`

**含义**:  
用于判断对齐句子对的语义相似度是否足够高。低于此阈值的对齐将被标记为"相似度低 (Low Similarity)"。

**工作原理**:  
- 使用 LaBSE (Language-agnostic BERT Sentence Embeddings) 计算源句子和目标句子的语义向量
- 计算余弦相似度 (Cosine Similarity)
- 如果相似度 < `similarity_threshold`，则标记为"相似度低"

**使用建议**:
- **直译式翻译** (技术文档、新闻、学术论文): `0.7` - `0.75`
  - 直译的语义相似度应该较高
  - 较高的阈值可以检测出翻译不准确的地方
- **改写式翻译** (戏剧、文学、创意翻译): `0.6` - `0.65`
  - 改写式翻译的语义相似度普遍较低
  - 降低阈值可以减少误报

**示例**:
```
源文本: "The cat sat on the mat."
目标文本: "猫坐在垫子上。"
相似度: 0.85 → OK

源文本: "The cat sat on the mat."
目标文本: "一只猫在垫子上休息。"
相似度: 0.68 → 相似度低 (如果阈值=0.7)
```

---

### 2. 强制拆散阈值 (Force Split Threshold)

**参数名**: `force_split_threshold`  
**默认值**: `0.5`  
**取值范围**: `0.0 - 1.0`  
**步长**: `0.05`

**含义**:  
用于判断对齐组的相似度是否过低，需要强制拆散为"缺失 (Omission)"和"增添 (Addition)"。

**工作原理**:  
- 如果对齐组的相似度 < `force_split_threshold`，则认为这个对齐不可靠
- 将源句子标记为"缺失 (Omission)"
- 将目标句子标记为"增添 (Addition)"

**使用建议**:
- **直译式翻译**: `0.5`
  - 中等阈值，拆散明显不匹配的对齐
- **改写式翻译**: `0.4` - `0.45`
  - 降低阈值，避免拆散合理的改写对齐
  - 只拆散极低相似度的对齐

**示例**:
```
源文本: "Chapter 1: Introduction"
目标文本: "第五章：结论"
相似度: 0.35 → 强制拆散 (如果阈值=0.5)
  → 源文本标记为"缺失"
  → 目标文本标记为"增添"
```

---

## Bertalign 对齐参数

### 3. 最大对齐数 (Max Align)

**参数名**: `max_align`  
**默认值**: `5`  
**取值范围**: `1 - 10`  
**步长**: `1`

**含义**:  
N:M 对齐中的 max(N, M)。限制一个对齐组中最多可以包含多少个源句子或目标句子。

**工作原理**:  
- Bertalign 会尝试找到最佳的 N:M 对齐
- `max_align` 限制了 N 和 M 的最大值
- 例如，`max_align=5` 表示最多可以有 5:1、1:5、3:2、2:3 等对齐

**使用建议**:
- **一般情况**: `5`
  - 适合大多数翻译场景
- **复杂翻译** (大量合并/拆分): `6 - 8`
  - 允许更多句子合并
- **简单翻译** (基本1:1对齐): `3 - 4`
  - 限制过度合并

**示例**:
```
max_align=5:
  可以对齐: 1:1, 1:2, 2:1, 3:2, 2:3, 5:1, 1:5, ...
  不能对齐: 6:1, 1:6, 4:3, ...

max_align=3:
  可以对齐: 1:1, 1:2, 2:1, 3:1, 1:3, 2:2
  不能对齐: 4:1, 1:4, 3:2, ...
```

---

### 4. Top-K

**参数名**: `top_k`  
**默认值**: `3`  
**取值范围**: `1 - 10`  
**步长**: `1`

**含义**:  
Bertalign 在搜索最佳对齐时，每一步保留的候选对齐数量。

**工作原理**:  
- Bertalign 使用动态规划搜索最佳对齐路径
- 在每一步，保留得分最高的 `top_k` 个候选
- 较大的 `top_k` 会增加搜索空间，可能找到更好的对齐，但速度较慢

**使用建议**:
- **一般情况**: `3`
  - 平衡速度和质量
- **高质量对齐**: `5 - 7`
  - 更全面的搜索，速度较慢
- **快速对齐**: `1 - 2`
  - 贪心搜索，速度快但可能不是最优

---

### 5. 跳过惩罚 (Skip Penalty)

**参数名**: `skip`  
**默认值**: `-1.0`  
**取值范围**: `-2.0 - 0.0`  
**步长**: `0.1`

**含义**:  
控制 Bertalign 对"跳过"（即缺失/增添）的惩罚程度。越负越倾向于 N:M 对齐而非缺失/增添。

**工作原理**:  
- 当 Bertalign 遇到不匹配的句子时，有两种选择：
  1. 标记为缺失/增添（跳过）
  2. 尝试 N:M 对齐
- `skip` 参数控制选择 1 的代价
- `skip` 越负，选择 1 的代价越高，越倾向于选择 2

**使用建议**:
- **一般情况**: `-1.0`
  - 平衡 N:M 对齐和缺失/增添
- **倾向 N:M 对齐**: `-1.5` - `-2.0`
  - 尽量避免缺失/增添，多用 N:M 对齐
- **倾向缺失/增添**: `-0.5` - `-0.1`
  - 更容易标记为缺失/增添
  - ⚠️ **注意**: 过高的值（如 `-0.1`）可能导致错误地合并独立的 1:1 对齐

**示例**:
```
skip=-1.0:
  源: [A, B, C]
  目标: [X, Y]
  结果: A→X (1:1), B+C→Y (2:1)

skip=-0.1:
  源: [A, B, C]
  目标: [X, Y]
  结果: A+B→X+Y (2:2) ← 错误地合并了独立对齐

skip=-2.0:
  源: [A, B, C]
  目标: [X, Y]
  结果: A+B+C→X+Y (3:2) ← 过度合并
```

---

### 6. 窗口大小 (Window Size)

**参数名**: `win`  
**默认值**: `5`  
**取值范围**: `1 - 20`  
**步长**: `1`

**含义**:  
Bertalign 在搜索对齐时的窗口大小。限制搜索范围，提高速度。

**工作原理**:  
- Bertalign 使用滑动窗口搜索对齐
- `win` 参数控制窗口的大小
- 较大的窗口可以处理更大的句子顺序变化，但速度较慢

**使用建议**:
- **一般情况**: `5`
  - 适合大多数翻译场景
- **句子顺序变化大**: `10 - 15`
  - 例如，文学翻译中句子顺序可能调整
- **句子顺序基本一致**: `3 - 4`
  - 例如，技术文档翻译

---

### 7. 分数阈值 (Score Threshold)

**参数名**: `score_threshold`  
**默认值**: `0.0`  
**取值范围**: `0.0 - 1.0`  
**步长**: `0.05`

**含义**:  
Bertalign 的分数阈值。低于此阈值的对齐候选将被过滤掉。

**工作原理**:  
- Bertalign 为每个对齐候选计算得分
- 得分 < `score_threshold` 的候选将被丢弃
- 较高的阈值会过滤掉更多低质量对齐

**使用建议**:
- **一般情况**: `0.0` - `0.15`
  - 不过滤或轻度过滤
- **高质量翻译**: `0.2 - 0.3`
  - 过滤低质量对齐
- **低质量翻译**: `0.0`
  - 不过滤，尽量找到对齐

---

## 高级功能

### 8. 使用最小相似度 (Use Min Similarity)

**参数名**: `use_min_similarity`  
**默认值**: `True` (勾选)  
**类型**: 布尔值 (复选框)

**含义**:  
对于 N:M 对齐（N>1 或 M>1），是否使用所有句子对的最小相似度作为该对齐组的相似度。

**工作原理**:  
- **启用** (`True`): 计算所有源-目标句子对的相似度，取最小值
  - 例如，2:2 对齐有 4 个句子对，取最小相似度
  - 更严格，能检测出 N:M 对齐中的弱链接
- **禁用** (`False`): 使用 Bertalign 返回的对齐得分
  - 较宽松

**使用建议**:
- **一般情况**: `True` (启用)
  - 更严格的质量检测
- **改写式翻译**: `False` (禁用)
  - 避免过度严格

**示例**:
```
2:2 对齐:
  源: [A, B]
  目标: [X, Y]
  
  句子对相似度:
    A-X: 0.85
    A-Y: 0.60
    B-X: 0.55
    B-Y: 0.90
  
  use_min_similarity=True: 相似度 = 0.55 (最小值)
  use_min_similarity=False: 相似度 = 0.75 (Bertalign得分)
```

---

### 9. 自动拆散N:M对齐 (Auto Split N:M)

**参数名**: `auto_split_nm`  
**默认值**: `True` (勾选)  
**类型**: 布尔值 (复选框)

**含义**:  
如果 N:N 对齐（N==M 且 N>1）拆散后的 1:1 相似度平均值更高，则自动拆散为多个 1:1 对齐。

**工作原理**:  
- 只处理 N:N 对齐（例如 2:2、3:3）
- 计算拆散后的 1:1 相似度
- 如果平均 1:1 相似度 > N:N 相似度，则拆散

**使用建议**:
- **直译式翻译**: `True` (启用)
  - 自动修正错误的 N:N 对齐
  - 例如，两个独立的 1:1 对齐被错误合并成 2:2
- **改写式翻译**: `False` (禁用)
  - 保留 N:N 对齐，因为改写式翻译经常需要多对多对齐

**示例**:
```
auto_split_nm=True:
  原始对齐: [A, B] → [X, Y] (2:2, 相似度 0.65)
  拆散后:
    A → X (1:1, 相似度 0.80)
    B → Y (1:1, 相似度 0.85)
  平均 1:1 相似度 (0.825) > 2:2 相似度 (0.65)
  → 自动拆散为两个 1:1 对齐

auto_split_nm=False:
  保持 2:2 对齐
```

---

## 推荐配置

### 配置 1: 直译式翻译（技术文档、新闻、学术论文）

```
质量检测参数:
  similarity_threshold = 0.7
  force_split_threshold = 0.5

Bertalign 对齐参数:
  max_align = 5
  top_k = 3
  skip = -1.0
  win = 5
  score_threshold = 0.0

高级功能:
  use_min_similarity = True (勾选)
  auto_split_nm = True (勾选)
```

**适用场景**:
- 技术文档翻译
- 新闻翻译
- 学术论文翻译
- 法律文件翻译

**特点**:
- 严格的相似度要求
- 自动拆散错误的 N:N 对齐
- 适合句子顺序基本一致的翻译

---

### 配置 2: 改写式翻译（戏剧、文学、创意翻译）

```
质量检测参数:
  similarity_threshold = 0.6
  force_split_threshold = 0.4

Bertalign 对齐参数:
  max_align = 6
  top_k = 3
  skip = -1.0
  win = 5
  score_threshold = 0.0

高级功能:
  use_min_similarity = False (不勾选)
  auto_split_nm = False (不勾选)
```

**适用场景**:
- 戏剧翻译
- 文学作品翻译
- 创意翻译
- 营销文案翻译

**特点**:
- 宽松的相似度要求
- 保留 N:M 对齐
- 适合大量改写、合并、拆分的翻译

---

### 配置 3: 高质量对齐（追求最佳对齐质量）

```
质量检测参数:
  similarity_threshold = 0.7
  force_split_threshold = 0.5

Bertalign 对齐参数:
  max_align = 8
  top_k = 5
  skip = -1.5
  win = 10
  score_threshold = 0.0

高级功能:
  use_min_similarity = True (勾选)
  auto_split_nm = True (勾选)
```

**适用场景**:
- 对齐质量要求极高
- 不在乎处理速度
- 复杂的翻译场景

**特点**:
- 更全面的搜索空间
- 更倾向于 N:M 对齐
- 处理速度较慢

---

### 配置 4: 快速对齐（追求速度）

```
质量检测参数:
  similarity_threshold = 0.7
  force_split_threshold = 0.5

Bertalign 对齐参数:
  max_align = 3
  top_k = 1
  skip = -1.0
  win = 3
  score_threshold = 0.0

高级功能:
  use_min_similarity = False (不勾选)
  auto_split_nm = False (不勾选)
```

**适用场景**:
- 大量文本需要快速处理
- 对齐质量要求不高
- 简单的翻译场景

**特点**:
- 贪心搜索，速度快
- 限制 N:M 对齐的复杂度
- 可能不是最优对齐

---

## 参数调优建议

### 1. 如果出现大量"缺失"和"增添"

**可能原因**: `skip` 参数过高（接近 0）

**解决方案**:
- 降低 `skip` 参数（例如从 `-0.5` 降到 `-1.0`）
- 增加 `max_align`（例如从 `5` 增到 `6` 或 `7`）

---

### 2. 如果出现错误的 N:N 对齐（应该是多个 1:1）

**可能原因**: `skip` 参数过低（过于负）或 `auto_split_nm` 未启用

**解决方案**:
- 提高 `skip` 参数（例如从 `-2.0` 提到 `-1.0`）
- 启用 `auto_split_nm`

---

### 3. 如果出现大量"相似度低"

**可能原因**: `similarity_threshold` 过高

**解决方案**:
- 降低 `similarity_threshold`（例如从 `0.7` 降到 `0.6`）
- 检查翻译质量是否确实较低

---

### 4. 如果对齐速度太慢

**可能原因**: `top_k`、`max_align`、`win` 过大

**解决方案**:
- 降低 `top_k`（例如从 `5` 降到 `3`）
- 降低 `max_align`（例如从 `8` 降到 `5`）
- 降低 `win`（例如从 `10` 降到 `5`）

---

## 总结

- **质量检测参数** (`similarity_threshold`, `force_split_threshold`): 控制质量检测的严格程度
- **Bertalign 对齐参数** (`max_align`, `top_k`, `skip`, `win`, `score_threshold`): 控制对齐算法的行为
- **高级功能** (`use_min_similarity`, `auto_split_nm`): 提供额外的质量控制

根据翻译类型选择合适的配置，可以显著提高对齐质量和检测准确性。

