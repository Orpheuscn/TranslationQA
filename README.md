# ç¿»è¯‘è´¨é‡æ£€æŸ¥å·¥å…·

è‡ªåŠ¨åŒ–çš„ç¿»è¯‘è´¨é‡æ£€æŸ¥å·¥å…·ï¼Œåœ¨å¥å­çº§åˆ«ä¸Šæ£€æµ‹ç¼ºå¤±ã€å¢æ·»å’Œè¯­ä¹‰æ­ªæ›²ã€‚

## ğŸŒ Webç‰ˆï¼ˆæ¨èï¼‰

### å¿«é€Ÿå¼€å§‹

```bash
# 1. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 2. å¯åŠ¨æœåŠ¡å™¨
./start_server.sh

# 3. è®¿é—®ç½‘é¡µ
# æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://localhost:5001
```

è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹ [WEB_README.md](WEB_README.md)

---

## âœ¨ ç‰¹æ€§

- âœ… **N:Må¥å­å¯¹é½**: ä½¿ç”¨Bertalignè¿›è¡Œå¤šå¯¹å¤šè¯­ä¹‰å¯¹é½ï¼ˆæ”¯æŒæœ€å¤š6:6å¯¹é½ï¼‰
- âœ… **è·¨è¯­è¨€è¯­ä¹‰ç›¸ä¼¼åº¦**: ä½¿ç”¨LaBSE ONNXæ¨¡å‹è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦
- âœ… **ä¸‰ç§å¼‚å¸¸æ£€æµ‹**: ç¼ºå¤±ã€å¢æ·»ã€ç›¸ä¼¼åº¦ä½
- âœ… **å¼ºåˆ¶æ‹†æ•£åŠŸèƒ½**: å°†ä½ç›¸ä¼¼åº¦å¯¹é½ç»„æ‹†æ•£ä¸ºç¼ºå¤±+å¢æ·»
- âœ… **æœ€å°ç›¸ä¼¼åº¦ç­–ç•¥**: é¿å…å‘é‡å¹³å‡æ©ç›–ä¸ç›¸å…³å¥å­
- âœ… **Webç•Œé¢**: å‹å¥½çš„ç½‘é¡µç•Œé¢ï¼Œå®æ—¶æ£€æµ‹ï¼Œå¯¼å‡ºCSV
- âœ… **è‡ªåŠ¨åˆ†å¥**: æ”¯æŒspaCyã€HanLPæˆ–ç®€å•è§„åˆ™åˆ†å¥
- âœ… **å¤šæ ¼å¼æŠ¥å‘Š**: JSONå’ŒCSVæ ¼å¼ï¼ŒCSVæŒ‰æºç´¢å¼•æ’åºä¾¿äºå®¡æŸ¥
- âœ… **macOS ARM64å…¼å®¹**: å·²ä¿®è¡¥Bertalignï¼Œé¿å…Segmentation fault

## ğŸš€ Python APIä½¿ç”¨

### å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### åŸºæœ¬ä½¿ç”¨

```python
from translation_qa_tool import TranslationQA

# åˆå§‹åŒ–å·¥å…·
qa_tool = TranslationQA(
    similarity_threshold=0.7,    # ç›¸ä¼¼åº¦é˜ˆå€¼
    max_align=6,                 # æœ€å¤§å¯¹é½æ•°
    top_k=5,                     # top-kå€™é€‰æ•°
    skip=-1.0,                   # è·³è¿‡æƒ©ç½š
    win=10                       # çª—å£å¤§å°
)

# æ£€æŸ¥ç¿»è¯‘è´¨é‡
results = qa_tool.check_translation(
    source_text="Your source text here.",
    target_text="Your target text here.",
    is_split=True  # å¦‚æœå·²åˆ†å¥ï¼Œè®¾ä¸ºTrue
)

# ä¿å­˜æŠ¥å‘Š
qa_tool.save_report_json(results, "report.json")
qa_tool.save_report_csv(results, "report.csv")

# æ‰“å°æ‘˜è¦
qa_tool.print_summary(results)
```

### è¿è¡Œæµ‹è¯•

```bash
python test.py
```

## ğŸ“Š è¾“å‡ºç¤ºä¾‹

### CSVæŠ¥å‘Šæ ¼å¼

```csv
åŸæ–‡ (Source),è¯‘æ–‡ (Target),æºç´¢å¼•,ç›®æ ‡ç´¢å¼•,ç›¸ä¼¼åº¦ (Similarity),å¼‚å¸¸æƒ…å†µ (Exception)
The Quantum Processor is the core.,é‡å­å¤„ç†å™¨æ˜¯æ ¸å¿ƒã€‚,0,0,0.9095,OK
It handles critical computations.,å®ƒè´Ÿè´£å…³é”®è®¡ç®—ã€‚,1,1,0.7415,OK
This sentence is omitted.,,2,,,ç¼ºå¤± (Omission)
The system is stable.,ç³»ç»Ÿç¨³å®šã€‚,3,2,0.8500,OK
,è¿™æ˜¯é¢å¤–çš„è¯‘æ–‡ã€‚,,3,,å¢æ·» (Addition)
```

### JSONæŠ¥å‘Šæ ¼å¼

```json
{
  "metadata": {
    "timestamp": "2024-01-01T12:00:00",
    "source_sentences": 4,
    "target_sentences": 4,
    "alignments_count": 3,
    "similarity_threshold": 0.7
  },
  "alignments": [
    {
      "src_indices": [0],
      "tgt_indices": [0],
      "similarity": 0.9095
    }
  ],
  "issues": {
    "omissions": [...],
    "additions": [...],
    "low_similarity": [...]
  }
}
```

## âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### æ‰¹é‡å¤„ç†å¤šä¸ªæ–‡æ¡£

âŒ **é”™è¯¯ç”¨æ³•** (æ¯æ¬¡éƒ½é‡æ–°åˆå§‹åŒ–):

```python
for src, tgt in document_pairs:
    qa_tool = TranslationQA()  # âŒ é‡å¤åŠ è½½spaCy/HanLPæ¨¡å‹
    results = qa_tool.check_translation(src, tgt)
```

âœ… **æ­£ç¡®ç”¨æ³•** (å¤ç”¨å®ä¾‹):

```python
qa_tool = TranslationQA()  # âœ… åªåˆå§‹åŒ–ä¸€æ¬¡
for src, tgt in document_pairs:
    results = qa_tool.check_translation(src, tgt)
```

**æ€§èƒ½æå‡**: å¦‚æœå¯ç”¨spaCyï¼Œå¯èŠ‚çœ ~1ç§’/æ–‡æ¡£

### æ€§èƒ½è¯´æ˜

- **Bertalignæ¨¡å‹**: å…¨å±€å•ä¾‹ï¼Œä¸ä¼šé‡å¤åŠ è½½
- **Embeddingè®¡ç®—**: æ¯æ¬¡å¤„ç†æ–°æ–‡æœ¬éƒ½éœ€è¦ï¼ˆ~1.5ç§’ï¼‰ï¼Œè¿™æ˜¯å¿…è¦å¼€é”€
- **TextSplitter**: åœ¨`TranslationQA.__init__`ä¸­åˆå§‹åŒ–ï¼Œå¤ç”¨å®ä¾‹å¯é¿å…é‡å¤åŠ è½½

è¯¦è§ `æ€§èƒ½åˆ†ææŠ¥å‘Š.md`

---

## ğŸ”§ å‚æ•°è¯´æ˜

### Bertalignå‚æ•°ï¼ˆå·²ä¼˜åŒ–ï¼‰

- `max_align=6`: æ”¯æŒæœ€å¤š6:6çš„å¤æ‚å¯¹é½ï¼ˆå¦‚4:2, 3:3ç­‰ï¼‰
- `skip=-1.0`: å¼ºæƒ©ç½š"è·³è¿‡"ï¼Œä½¿ç®—æ³•å€¾å‘äºN:Må¯¹é½è€Œéç¼ºå¤±
- `top_k=5`: å¢åŠ å€™é€‰æ•°ï¼Œæé«˜å¯¹é½è´¨é‡
- `win=10`: æ‰©å¤§æœç´¢çª—å£ï¼Œæ•æ‰æ›´è¿œè·ç¦»çš„å¯¹é½

### ç›¸ä¼¼åº¦é˜ˆå€¼

- `similarity_threshold=0.7`: ä½äºæ­¤å€¼çš„å¯¹é½è¢«æ ‡è®°ä¸º"ç›¸ä¼¼åº¦ä½"

## ğŸ“ æ–‡ä»¶ç»“æ„

```
.
â”œâ”€â”€ translation_qa_tool.py      # ä¸»å·¥å…·
â”œâ”€â”€ labse_onnx_encoder.py       # LaBSE ONNXç¼–ç å™¨
â”œâ”€â”€ text_splitter.py            # æ–‡æœ¬åˆ†å¥æ¨¡å—
â”œâ”€â”€ test.py                     # æµ‹è¯•è„šæœ¬
â”œâ”€â”€ labse_onnx/                 # LaBSE ONNXæ¨¡å‹
â”œâ”€â”€ venv/                       # è™šæ‹Ÿç¯å¢ƒï¼ˆå·²ä¿®è¡¥Bertalignï¼‰
â”œâ”€â”€ README.md                   # æœ¬æ–‡ä»¶
â”œâ”€â”€ README_FINAL.md             # è¯¦ç»†ä½¿ç”¨æ–‡æ¡£
â”œâ”€â”€ å·¥ä½œæµæ€»ç»“.md                # å·¥ä½œæµç¨‹è¯´æ˜
â”œâ”€â”€ ä¼˜åŒ–æ€»ç»“.md                  # ä¼˜åŒ–è¿‡ç¨‹æ€»ç»“
â””â”€â”€ æœ€ç»ˆä¿®å¤æ€»ç»“.md              # è‡´å‘½é—®é¢˜ä¿®å¤æ€»ç»“
```

## ğŸ› å·²ä¿®å¤çš„é—®é¢˜

### ğŸ”´ è‡´å‘½é—®é¢˜

1. **ç©ºå¯¹é½è¢«é”™è¯¯å½’ç±»**: ä¿®å¤äº†Bertalignè¿”å›ç©ºå¯¹é½æ—¶è¢«å½’ç±»ä¸º"ç›¸ä¼¼åº¦ä½"çš„é—®é¢˜
2. **CSVæ’åºæ··ä¹±**: ä¿®å¤äº†ç¼ºå¤±/å¢æ·»è¢«è¿½åŠ åˆ°æœ€åï¼Œç ´åä¸Šä¸‹æ–‡çš„é—®é¢˜

### ğŸŸ  æ¬¡è¦é—®é¢˜

3. **N:Må¯¹é½è¿‡äºä¿å®ˆ**: é€šè¿‡å‚æ•°è°ƒä¼˜ï¼Œæ”¯æŒæ›´å¤æ‚çš„å¯¹é½
4. **CSVå¤šè¡Œå¹³é“º**: ä¿®å¤äº†N:Må¯¹é½å±•å¼€é€»è¾‘

è¯¦è§ `æœ€ç»ˆä¿®å¤æ€»ç»“.md`

## ğŸ“š æŠ€æœ¯æ ˆ

- **å¥å­å¯¹é½**: Bertalign 1.1.0 (å·²ä¿®è¡¥)
- **è¯­ä¹‰åµŒå…¥**: LaBSE ONNX (768ç»´å‘é‡)
- **ç›¸ä¼¼åº¦è®¡ç®—**: ä½™å¼¦ç›¸ä¼¼åº¦ï¼ˆå‘é‡å¹³å‡ï¼‰
- **åˆ†å¥**: spaCy / HanLP / ç®€å•è§„åˆ™

## âš ï¸ é‡è¦è¯´æ˜ï¼šBertalignçš„å¯¹é½è¡Œä¸ºä¸å¼ºåˆ¶æ‹†æ•£åŠŸèƒ½

**Bertalignä¼šå°½å¯èƒ½å¯¹é½æ‰€æœ‰å¥å­ï¼Œå¾ˆå°‘äº§ç”Ÿç©ºå¯¹é½ï¼ˆç¼ºå¤±/å¢æ·»ï¼‰**

### ğŸ†• å¼ºåˆ¶æ‹†æ•£åŠŸèƒ½ (Force Split)

ä¸ºäº†è§£å†³Bertalignçš„"å¼ºåˆ¶å¯¹é½åå·®"ï¼Œæˆ‘ä»¬å®ç°äº†ä¸¤ä¸ªå…³é”®åŠŸèƒ½ï¼š

1. **æœ€å°ç›¸ä¼¼åº¦ç­–ç•¥** (`use_min_similarity=True`): å¯¹N:Må¯¹é½ï¼Œå–æ‰€æœ‰å¥å­å¯¹çš„æœ€å°ç›¸ä¼¼åº¦ï¼Œé¿å…å‘é‡å¹³å‡æ©ç›–ä¸ç›¸å…³å¥å­
2. **å¼ºåˆ¶æ‹†æ•£æœºåˆ¶** (`force_split_threshold=0.5`): å°†ä½ç›¸ä¼¼åº¦å¯¹é½ç»„æ‹†æ•£ä¸ºç¼ºå¤±+å¢æ·»

### å®é™…å¼‚å¸¸æ£€æµ‹æ–¹å¼

| å¼‚å¸¸ç±»å‹ | æ£€æµ‹æ–¹å¼ | æ•ˆæœ |
|---------|---------|------|
| ç¼ºå¤± (Omission) | å¼ºåˆ¶æ‹†æ•£ (ç›¸ä¼¼åº¦ < 0.5) | âœ… æœ‰æ•ˆ |
| å¢æ·» (Addition) | å¼ºåˆ¶æ‹†æ•£ (ç›¸ä¼¼åº¦ < 0.5) | âœ… æœ‰æ•ˆ |
| ç›¸ä¼¼åº¦ä½ | é˜ˆå€¼æ£€æµ‹ (0.5 â‰¤ ç›¸ä¼¼åº¦ < 0.7) | âœ… æœ‰æ•ˆ |

### æ¨èé…ç½®

```python
qa_tool = TranslationQA(
    similarity_threshold=0.7,      # ç›¸ä¼¼åº¦ä½é˜ˆå€¼
    force_split_threshold=0.5,     # å¼ºåˆ¶æ‹†æ•£é˜ˆå€¼
    use_min_similarity=True        # ä½¿ç”¨æœ€å°ç›¸ä¼¼åº¦ï¼ˆæ¨èï¼‰
)
```

### ä½¿ç”¨å»ºè®®

æŸ¥çœ‹CSVæŠ¥å‘Šæ—¶ï¼š
- âœ… å…³æ³¨"ç¼ºå¤±"å’Œ"å¢æ·»"ï¼Œæ£€æŸ¥æ˜¯å¦åˆç†
- âœ… å…³æ³¨"ç›¸ä¼¼åº¦ä½"ï¼Œæ£€æŸ¥æ˜¯å¦ä¸ºæ„è¯‘æˆ–é”™è¯‘
- âœ… å…³æ³¨"å¼ºåˆ¶æ‹†æ•£å¯¹é½ç»„"æ•°é‡ï¼Œè¯„ä¼°é˜ˆå€¼æ˜¯å¦åˆé€‚

è¯¦è§ `å¼ºåˆ¶æ‹†æ•£åŠŸèƒ½è¯´æ˜.md` å’Œ `Bertalignè¡Œä¸ºè¯´æ˜.md`

## ğŸ¯ ä½¿ç”¨åœºæ™¯

- ç¿»è¯‘è´¨é‡æ£€æŸ¥
- åŒè¯­è¯­æ–™å¯¹é½éªŒè¯
- ç¿»è¯‘é—æ¼æ£€æµ‹
- ç¿»è¯‘å¢æ·»æ£€æµ‹
- è¯­ä¹‰æ­ªæ›²æ£€æµ‹

## ğŸ“ è®¸å¯

MIT License

## ğŸ™ è‡´è°¢

- Bertalign: https://github.com/bfsujason/bertalign
- LaBSE: https://huggingface.co/sentence-transformers/LaBSE
- ONNX Runtime: https://onnxruntime.ai/

